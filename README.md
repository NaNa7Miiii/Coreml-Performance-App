# Coreml-Performance-App
This project is based on Vladimir Chernykh coreml-performance project for iOS. Our implementation extends the original project by adding a user interface to simplify model selection and device configuration. Additionally, I've added a screen-off latency function to get a better performance, hopefully.

# Quick Start
1. Clone the repository
2. Open the project in Xcode
3. Build and run the project using either a virtual device or a real device. This code is tested using iOS 16.1.1
4. The performance result depends on the device selected (CPU, GPU, ANE, All). The latency calculation is completely based on Vladimir Chernykh's coreml-performance: 50 iterations on CPU for warm-up, then take the average of 500 inferences running on selected devices.

# Current Models included
| Model Name            | Input size | Top 1 Accuracy (%) | Size (MB) | # of Parameters (M) | FLOPs (G) | # of Activations (million) | Latency on CPU (ms) | CPU Screen-off Latency (ms) | Latency on ANE (ms) | ANE Screen-off Latency (ms) | Latency on GPU (ms) | GPU Screen-off Latency (ms) | Cpu/Gpu Operation Ratio | Model Link                                                                                 |   |   |   |                                                                                                                                                                                                  |
|-----------------------|------------|--------------------|-----------|---------------------|-----------|----------------------------|---------------------|-----------------------------|---------------------|-----------------------------|---------------------|-----------------------------|-------------------------|--------------------------------------------------------------------------------------------|---|---|---|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Nextvit_small         | 224        | 82.5               | 126.98    | 31.763              | 5.811     | 18.4387                    | 35.2382             | 32.8724                     | 3.5006              | 3.6397                      | 129.4218            | 128.0627                    | 85/167                  | https://github.com/bytedance/Next-ViT                                                      |   |   |   |                                                                                                                                                                                                  |
| Nextvit_base          | 224        | 83.2               | 179.15    | 44.819              | 8.294     | 23.7119                    | 49.7409             | 47.593                      | 4.4305              | 4.4405                      | 193.8774            | 191.1534                    | 129/245                 | https://github.com/bytedance/Next-ViT                                                      |   |   |   |                                                                                                                                                                                                  |
| Nextvit_large         | 224        | 83.6               | 231.33    | 57.874              | 10.777    | 28.99                      | 66.3024             | 63.8838                     | 5.2163              | 5.2543                      | 259.4616            | 254.9647                    | 173/323                 | https://github.com/bytedance/Next-ViT                                                      |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v1_L1 | 224        | 80.2               | 49.1      | 12.29               | 1.302     | 5.53                       | 92.7071             | 89.3694                     | 1.5094              | 1.5061                      | 34.8053             | 37.0175                     | 42/148                  | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v1_L3 | 224        | 82.4               | 125.7     | 31.406              | 3.929     | 12                         | 208.3578            | 195.6442                    | 2.8547              | 2.838                       | 60.2183             | 60.9759                     | 141/228                 | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v1_L7 | 224        | 83.3               | 329.2     | 82.229              | 10.166    | 24.45                      | 423.6137            | 418.5314                    | 8.2246              | 7.0521                      | 89.8642             | 87.6807                     | 273/308                 | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v2_S0 | 224        | 76.2               | 14.2      | 3.6                 | 0.407     | 5.3                        | 51.3086             | 53.118                      | 0.9832              | 0.9486                      | 23.08.06            | 24.9469                     | 107/121                 | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v2_S1 | 224        | 79.7               | 24.5      | 6.186               | 0.668     | 7.66                       | 77.493              | 76.9783                     | 1.1349              | 1.1132                      | 46.6044             | 49.8199                     | 57/217                  | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v2_S2 | 224        | 82                 | 51        | 12.71               | 1.272     | 11.77                      | 125.7969            | 125.5408                    | 2.0281              | 1.7036                      | 72.8974             | 79.8179                     | 76/350                  | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientformer_v2_L  | 224        | 83.5               | 109.14    | 26.322              | 2.952     | 18.54                      | 130.3785            | 196.6161                    | 11.4116             | 2.97                        | 88.9284             | 114.9263                    | 108/468                 | https://github.com/snap-research/EfficientFormer                                           |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b0       | 224        | 77.692             | 17.3      | 5.289               | 0.422     | 6.75                       | 16.9126             | 15.1892                     | 1.7491              | 1.9978                      | 26.7446             | 31.6968                     | 234/65                  | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b0.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b1       | 240        | 78.642             | 27.5      | 7.794               | 0.62      | 9.36                       | 23.3418             | 23.5011                     | 2.5068              | 2.7444                      | 36.3961             | 39.4964                     | 326/102                 | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b1.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b2       | 260        | 80.608             | 32.5      | 9.11                | 0.712     | 9.81                       | 36.6151             | 30.964                      | 3.6823              | 3.9599                      | 42.6457             | 45.3414                     | 223/219                 | https://pytorch.org/vision/master/models/generated/torchvision.models.efficientnet_b2.html |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b3       | 300        | 82.008             | 45        | 12.233              | 1.033     | 13.01                      | 65.1021             | 56.7066                     | 5.5076              | 5.4112                      | 47.3737             | 47.4935                     | 76/444                  | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b3.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b4       | 380        | 83.384             | 73.7      | 19.342              | 1.596     | 17.05                      | 111.996             | 140.9594                    | 10.374              | 10.6086                     | 55.6502             | 60.2639                     | 66/576                  | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b4.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b5       | 456        | 83.444             | 118.4     | 30.39               | 2.483     | 23.42                      | 262.8067            | 301.8053                    | 21.99               | 23.5284                     | 110.4733            | 117.6386                    | 80/699                  | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b5.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b6       | 528        | 84.008             | 169.6     | 43.041              | 3.522     | 29.97                      | 490.5762            | 1049.7971                   | 52.0414             | 80.4585                     | 201.4061            | 354.2627                    | 92/807                  | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b6.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_b7       | 600        | 84.122             | 263.7     | 66.348              | 5.387     | 40.09                      | 947.5508            | 1993.4706                   | 86.9574             | 140.0038                    | 364.3727            | 634.417                     | 112/984                 | https://pytorch.org/vision/main/models/generated/torchvision.models.efficientnet_b7.html   |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_v2_s     | 224        | 84.228             | 85.6      | 21.458              | 2.878     | 12.19                      | 35.8593             | 79.2411                     | 3.0237              | 3.115                       | 48.5658             | 49.7699                     | 2/501                   | https://pytorch.org/vision/main/models/efficientnetv2.html                                 |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_v2_m     | 224        | 85.112             | 216       | 54.139              | 5.407     | 19.62                      | 70.4114             | 134.8219                    | 5.3902              | 10.1107                     | 61.1385             | 76.5697                     | 2/724                   | https://pytorch.org/vision/main/models/efficientnetv2.html                                 |   |   |   |                                                                                                                                                                                                  |
| Efficientnet_v2_l     | 224        | 85.808             | 473.1     | 119                 | 12.31     | 34.5                       | 126.4621            | 296.2575                    | 10.8362             | 22.1407                     | 89.462              | 142.8598                    | 2/1003                  | https://pytorch.org/vision/main/models/efficientnetv2.html                                 |   |   |   |                                                                                                                                                                                                  |
| Mobilenet_v1          | 224        | 70.9               | 16.9      | 4.233               | 0.579     | 5.04                       | 7.015               | 11.7229                     | 0.9196              | 1.2283                      | 20.9536             | 16.8175                     | 2/56                    | https://huggingface.co/docs/transformers/model_doc/mobilenet_v1#overview                   |   |   |   |                                                                                                                                                                                                  |
| Mobilenet_v2          | 224        | 71.88              | 14        | 3.505               | 0.314     | 6.68                       | 7.5591              | 13.0298                     | 1.0015              | 1.3022                      | 15.2767             | 15.9347                     | 2/99                    | https://pytorch.org/hub/pytorch_vision_mobilenet_v2/                                       |   |   |   |                                                                                                                                                                                                  |
| Mobilenet_v3_small    | 224        | 67.668             | 10.2      | 2.543               | 0.05965   | 1.42                       | 2.9943              | 3.7703                      | 11.4016             | 11.8068                     | 9.4581              | 10.2414                     | 6/141                   | https://pytorch.org/vision/main/models/mobilenetv3.html                                    |   |   |   |                                                                                                                                                                                                  |
| Mobilenet_v3_large    | 224        | 74.042             | 21.9      | 5.483               | 0.226     | 4.41                       | 6.674               | 10.7458                     | 18.6669             | 17.4548                     | 19.1962             | 21.0491                     | 6/158                   | https://pytorch.org/vision/main/models/mobilenetv3.html                                    |   |   |   |                                                                                                                                                                                                  |
| Mobilevit-s           | 224        | 78.4               | 22.3      | 5.579               | 1.547     | 14.94                      | 28.0709             | 60.7667                     | 34.9575             | 44.1935                     | 34.9805             | 43.3358                     | 328/83                  | https://huggingface.co/apple/mobilevit-small                                               |   |   |   | The ANE computation for Mobilevit model seems to have error:https://github.com/apple/ml-cvnets/issues/27 on the phone (I used the virtual phone to test it and it turns out to have no problems) |
| Mobilevit-xs          | 224        | 74.8               | 9.3       | 2.318               | 0.793     | 12.14                      | 21.8105             | 44.9384                     | 23.8962             | 32.1419                     | 24.0826             | 30.9254                     | 346/63                  | https://huggingface.co/apple/mobilevit-x-small                                             |   |   |   |                                                                                                                                                                                                  |
| Mobilevit-xxs         | 224        | 69                 | 5.1       | 1.272               | 0.31      | 5.99                       | 11.4366             | 20.9482                     | 14.1317             | 21.5464                     | 14.2482             | 20.6964                     | 346/64                  | https://huggingface.co/apple/mobilevit-xx-small                                            |   |   |   |                                                                                                                                                                                                  |
| mobilevit_v2_050      | 256        | 70.2               | 5.5       | 1.371               | 0.48      | 8.04                       | 18.0857             | 35.5047                     | 2.1501              | 3.0569                      | 20.862              | 29.6687                     | 381/49                  | https://huggingface.co/timm/mobilevitv2_050.cvnets_in1k                                    |   |   |   |                                                                                                                                                                                                  |
| mobilevit_v2_100      | 256        | 78.1               | 19.6      | 4.902               | 1.844     | 16.08                      | 41.568              | 87.458                      | 4.6649              | 6.6972                      | 52.4046             | 63.7646                     | 356/80                  | https://huggingface.co/timm/mobilevitv2_100.cvnets_in1k                                    |   |   |   |                                                                                                                                                                                                  |
| mobilevit_v2_150      | 256        | 80.4               | 42.4      | 10.595              | 4.09      | 24.11                      | 64.7349             | 152.913                     | 7.0944              | 7.8868                      | 112.0646            | 114.7588                    | 332/116                 | https://huggingface.co/timm/mobilevitv2_150.cvnets_in1k                                    |   |   |   |                                                                                                                                                                                                  |
| MobileOne_s0          | 224        | 71.4               | 8.3       | 2.079               | 0.275     | 3.79                       | 4.5283              | 6.3961                      | 0.7019              | 0.9531                      | 12.1953             | 10.6148                     | 2/45                    | https://github.com/apple/ml-mobileone                                                      |   |   |   |                                                                                                                                                                                                  |
| MobileOne_s1          | 224        | 75.9               | 19.1      | 4.765               | 0.825     | 6.27                       | 8.1541              | 8.0278                      | 0.9705              | 0.9536                      | 25.5753             | 19.1665                     | 2/45                    | https://github.com/apple/ml-mobileone                                                      |   |   |   |                                                                                                                                                                                                  |
| MobileOne_s2          | 224        | 77.4               | 31.2      | 7.808               | 1.299     | 7.56                       | 10.5839             | 21.4588                     | 1.1665              | 1.2043                      | 32.0026             | 24.8013                     | 2/45                    | https://github.com/apple/ml-mobileone                                                      |   |   |   |                                                                                                                                                                                                  |
| MobileOne_s3          | 224        | 78.1               | 40.3      | 10.078              | 1.896     | 9.13                       | 13.3721             | 28.4688                     | 1.3438              | 1.42                        | 38.4561             | 24.7752                     | 2/45                    | https://github.com/apple/ml-mobileone                                                      |   |   |   |                                                                                                                                                                                                  |
| MobileOne_S4          | 224        | 79.4               | 59.7      | 14.838              | 2.979     | 11.81                      | 19.3589             | 43.9258                     | 1.7511              | 3.0248                      | 55.2565             | 31.6534                     | 2/117                   | https://github.com/apple/ml-mobileone                                                      |   |   |   |                                                                                                                                                                                                  |
